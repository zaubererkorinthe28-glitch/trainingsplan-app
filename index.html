<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trainings-App</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { margin: 0; font-family: -apple-system, Arial; background: #f0f2f5; color: #333; }
.container { max-width: 500px; margin: auto; padding: 20px; }
header { text-align: center; padding: 10px 0; background: #4CAF50; color: #fff; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);}
h1,h2 { margin: 10px 0; }
input, select, button, textarea { padding: 8px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; width: 100%; box-sizing: border-box; }
button { background: #4CAF50; color: white; border: none; cursor: pointer; }
button:hover { background: #45a049; }
.tab { display: none; }
.tab.active { display: block; }
.nav { display: flex; justify-content: space-around; margin-bottom: 10px; }
.nav button { flex: 1; margin: 0 2px; background: #eee; color: #333; border-radius: 5px; }
.nav button.active { background: #4CAF50; color: #fff; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { padding: 5px; text-align: center; border-bottom: 1px solid #ccc; }
.flex { display: flex; gap: 5px; justify-content: center; }
textarea { resize: vertical; }
canvas { margin-top: 10px; }
.exercise-item { border:1px solid #ccc; border-radius:5px; padding:5px; margin:5px 0; background:#fff;}
.exercise-item button { margin: 2px; padding:4px; font-size:0.8em; }
</style>
</head>
<body>
<div class="container">
<header><h1>üèãÔ∏è Trainings-App</h1></header>

<div class="nav">
    <button onclick="showTab('plans')" id="tabBtnPlans" class="active">Pl√§ne</button>
    <button onclick="showTab('training')" id="tabBtnTraining">Training</button>
    <button onclick="showTab('progress')" id="tabBtnProgress">Fortschritt</button>
    <button onclick="showTab('overview')" id="tabBtnOverview">√úbersicht</button>
</div>

<!-- Pl√§ne Tab -->
<div id="plans" class="tab active">
<h2>Neuen Plan erstellen</h2>
<input type="text" id="planName" placeholder="Planname">
<button onclick="addPlan()">Plan hinzuf√ºgen</button>

<h2>Plan bearbeiten</h2>
<select id="selectPlan" onchange="loadPlan()">
<option value="">-- Plan w√§hlen --</option>
</select>

<input type="text" id="exerciseName" placeholder="√úbung">
<input type="number" id="sets" placeholder="S√§tze">
<label><input type="checkbox" id="bodyweight"> K√∂rpergewicht</label>
<textarea id="notes" placeholder="Notizen zur √úbung"></textarea>
<button onclick="addExercise()">√úbung hinzuf√ºgen</button>

<div id="exercises"></div>
</div>

<!-- Training Tab -->
<div id="training" class="tab">
<h2>Training starten</h2>
<select id="selectTrainingPlan" onchange="loadTrainingPlan()">
<option value="">-- Plan w√§hlen --</option>
</select>

<label>üìÖ Trainingsdatum:</label>
<input type="date" id="trainingDate" value="">
<div id="trainingExercises"></div>
<button onclick="saveTraining()">Training speichern</button>
</div>

<!-- Fortschritt Tab -->
<div id="progress" class="tab">
<h2>Fortschritt (plan√ºbergreifend)</h2>
<select id="exerciseSelectProgress" onchange="showProgressCrossPlans()">
<option value="">-- √úbung w√§hlen --</option>
</select>
<canvas id="chart" width="400" height="200"></canvas>
</div>

<!-- √úbersicht Tab -->
<div id="overview" class="tab">
<h2>Alle Trainingspl√§ne</h2>
<div id="allPlans"></div>
</div>

</div>

<script>
let plans = JSON.parse(localStorage.getItem('plans') || '{}');
let chart;

function showTab(tabId){
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
    document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
    document.getElementById('tabBtn'+tabId.charAt(0).toUpperCase()+tabId.slice(1)).classList.add('active');
    if(tabId === "plans") renderPlans();
    if(tabId === "progress") updateExerciseSelectProgress();
}

function saveData(){ localStorage.setItem('plans', JSON.stringify(plans)); }

function renderPlans(){
    const exercisesDiv = document.getElementById('exercises');
    const selectPlan = document.getElementById('selectPlan');
    const selectTrainingPlan = document.getElementById('selectTrainingPlan');
    selectPlan.innerHTML='<option value="">-- Plan w√§hlen --</option>';
    selectTrainingPlan.innerHTML='<option value="">-- Plan w√§hlen --</option>';
    for(let name in plans){
        selectPlan.innerHTML += `<option value="${name}">${name}</option>`;
        selectTrainingPlan.innerHTML += `<option value="${name}">${name}</option>`;
    }
    exercisesDiv.innerHTML='';
    renderOverview();
}

function loadPlan(){
    const planName = document.getElementById('selectPlan').value;
    const div = document.getElementById('exercises');
    div.innerHTML='';
    if(!planName) return;
    plans[planName].exercises.forEach((ex,i)=>{
        const eDiv = document.createElement('div');
        eDiv.className='exercise-item';
        eDiv.innerHTML=`<b>${ex.name}</b> - ${ex.sets} S√§tze${ex.bodyweight?' (K√∂rpergewicht)':''}<br>Notizen: ${ex.notes||''}
        <button onclick="editExercise('${planName}',${i})">Bearbeiten</button>
        <button onclick="deleteExercise('${planName}',${i})">L√∂schen</button>`;
        div.appendChild(eDiv);
    });
}

function addPlan(){
    const name = document.getElementById('planName').value.trim();
    if(!name) return alert('Planname erforderlich');
    if(plans[name]) return alert('Plan existiert bereits');
    plans[name]={ exercises: [], history: [] };
    saveData(); document.getElementById('planName').value='';
    renderPlans();
}

function addExercise(){
    const planName = document.getElementById('selectPlan').value;
    if(!planName) return alert('Bitte Plan ausw√§hlen');
    const exName = document.getElementById('exerciseName').value.trim();
    const sets = parseInt(document.getElementById('sets').value);
    const bodyweight = document.getElementById('bodyweight').checked;
    const notes = document.getElementById('notes').value.trim();
    if(!exName || !sets) return alert('√úbung und S√§tze erforderlich');
    plans[planName].exercises.push({name: exName, sets, bodyweight, notes});
    saveData();
    document.getElementById('exerciseName').value=''; document.getElementById('sets').value=''; document.getElementById('bodyweight').checked=false; document.getElementById('notes').value='';
    loadPlan();
}

function editExercise(planName,i){
    const ex=plans[planName].exercises[i];
    const newName=prompt('√úbungsname', ex.name);
    if(newName) ex.name=newName;
    const newSets=parseInt(prompt('S√§tze', ex.sets));
    if(newSets>0) ex.sets=newSets;
    const newBody=confirm('K√∂rpergewicht? OK=Ja, Abbrechen=Nein');
    ex.bodyweight=newBody;
    const newNotes=prompt('Notizen', ex.notes||'');
    ex.notes=newNotes;
    saveData(); loadPlan();
}

function deleteExercise(planName,i){
    if(confirm('√úbung l√∂schen?')){ plans[planName].exercises.splice(i,1); saveData(); loadPlan(); }
}

// Training
function loadTrainingPlan(){
    const planName = document.getElementById('selectTrainingPlan').value;
    const container = document.getElementById('trainingExercises');
    container.innerHTML='';
    if(!planName) return;
    if(!document.getElementById('trainingDate').value){
        document.getElementById('trainingDate').value = new Date().toISOString().split('T')[0];
    }
    plans[planName].exercises.forEach((ex,i)=>{
        let row = document.createElement('div');
        row.innerHTML = `<b>${ex.name}${ex.bodyweight?' (K√∂rpergewicht)':''}</b> (${ex.sets} S√§tze)
            <textarea placeholder="Notizen (optional)">${ex.notes||''}</textarea>`;
        for(let s=0;s<ex.sets;s++){
            let input = ex.bodyweight ?
            `<input type="text" placeholder="Wdh" id="rep_${i}_${s}">` :
            `<input type="text" placeholder="Gewicht (kg)" id="weight_${i}_${s}"> <input type="text" placeholder="Wdh" id="rep_${i}_${s}">`;
            row.innerHTML += `<div class="flex">Satz ${s+1}: ${input}</div>`;
        }
        container.appendChild(row);
    });
}

function saveTraining(){
    const planName = document.getElementById('selectTrainingPlan').value;
    if(!planName) return alert('Plan w√§hlen');
    const date = document.getElementById('trainingDate').value || new Date().toISOString().split('T')[0];
    const exercises = plans[planName].exercises;
    const entry = { date, data: [] };
    exercises.forEach((ex,i)=>{
        const setsData = [];
        for(let s=0;s<ex.sets;s++){
            const weight = ex.bodyweight ? null : Number(document.getElementById(`weight_${i}_${s}`).value);
            const reps = Number(document.getElementById(`rep_${i}_${s}`).value);
            setsData.push({weight,reps});
        }
        entry.data.push({ name: ex.name, sets: ex.sets, bodyweight: ex.bodyweight, setsData, notes: ex.notes });
    });
    plans[planName].history.push(entry);
    saveData();
    alert('Training gespeichert!');
    updateExerciseSelectProgress();
}

// Fortschritt
function updateExerciseSelectProgress(){
    const select = document.getElementById('exerciseSelectProgress');
    const exNames = new Set();
    for(let plan in plans){ plans[plan].exercises.forEach(ex=>exNames.add(ex.name)); }
    select.innerHTML='<option value="">-- √úbung w√§hlen --</option>';
    Array.from(exNames).forEach(name=>{ select.innerHTML += `<option value="${name}">${name}</option>`; });
}

function showProgressCrossPlans(){
    const exName = document.getElementById('exerciseSelectProgress').value;
    if(!exName) return;
    const allData=[];
    for(let plan in plans){
        plans[plan].history.forEach(entry=>{
            const ex = entry.data.find(e=>e.name===exName);
            if(ex){
                const total = ex.setsData.reduce((sum,set)=>sum+(set.weight?set.weight*set.reps:set.reps),0);
                const max = ex.setsData.reduce((m,set)=>Math.max(m,set.weight||0),0);
                allData.push({date: entry.date, total, max});
            }
        });
    }
    allData.sort((a,b)=>new Date(a.date)-new Date(b.date));
    const ctx = document.getElementById('chart').getContext('2d');
    if(chart) chart.destroy();
    chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: allData.map(d=>d.date),
            datasets: [
                { label:'Summe Wdh√óGewicht', data:allData.map(d=>d.total), borderColor:'#4CAF50', fill:false, tension:0.3 },
                { label:'Max Gewicht', data:allData.map(d=>d.max), borderColor:'#f44336', fill:false, tension:0.3 }
            ]
        },
        options: { responsive:true, scales:{y:{beginAtZero:true}} }
    });
}

// √úbersicht
function renderOverview(){
    const overview = document.getElementById('allPlans');
    overview.innerHTML='';
    for(let plan in plans){
        overview.innerHTML += `<h3>${plan}</h3><ul>`+
        plans[plan].exercises.map(ex=>`<li>${ex.name} - ${ex.sets} S√§tze${ex.bodyweight?' (K√∂rpergewicht)':''}<br>Notizen: ${ex.notes||''}</li>`).join('')+
        '</ul>';
    }
}

renderPlans();
updateExerciseSelectProgress();
</script>
</body>
</html>
