<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trainings-App</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { margin: 0; font-family: -apple-system, Arial; background: #f0f2f5; color: #333; }
.container { max-width: 500px; margin: auto; padding: 20px; }
header { text-align: center; padding: 10px 0; background: #4CAF50; color: #fff; border-radius: 10px; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);}
h1,h2 { margin: 10px 0; }
input, select, button, textarea { padding: 8px; margin: 5px 0; border-radius: 5px; border: 1px solid #ccc; width: 100%; box-sizing: border-box; }
button { background: #4CAF50; color: white; border: none; cursor: pointer; }
button:hover { background: #45a049; }
.tab { display: none; }
.tab.active { display: block; }
.nav { display: flex; justify-content: space-around; margin-bottom: 10px; }
.nav button { flex: 1; margin: 0 2px; background: #eee; color: #333; border-radius: 5px; }
.nav button.active { background: #4CAF50; color: #fff; }
.exercise-item { border:1px solid #ccc; border-radius:5px; padding:5px; margin:5px 0; background:#fff;}
.exercise-item button { margin: 2px; padding:4px; font-size:0.8em; }

/* Modal */
#editModal {
  display: none;
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.5);
  justify-content: center;
  align-items: center;
  z-index: 10;
}
.modal-content {
  background: white;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 400px;
}
.modal-buttons { display: flex; justify-content: space-between; }
.history-item { background:#fff; border:1px solid #ccc; border-radius:8px; margin:5px 0; padding:8px; }
</style>
</head>
<body>
<div class="container">
<header><h1>üèãÔ∏è Trainings-App</h1></header>

<div class="nav">
  <button onclick="showTab('plans')" id="tabBtnPlans" class="active">Pl√§ne</button>
  <button onclick="showTab('training')" id="tabBtnTraining">Training</button>
  <button onclick="showTab('progress')" id="tabBtnProgress">Fortschritt</button>
  <button onclick="showTab('history')" id="tabBtnHistory">Historie</button>
  <button onclick="showTab('overview')" id="tabBtnOverview">√úbersicht</button>
</div>

<!-- PL√ÑNE -->
<div id="plans" class="tab active">
<h2>Neuen Plan erstellen</h2>
<input type="text" id="planName" placeholder="Planname">
<button onclick="addPlan()">Plan hinzuf√ºgen</button>

<h2>Plan bearbeiten</h2>
<select id="selectPlan" onchange="loadPlan()">
<option value="">-- Plan w√§hlen --</option>
</select>
<button style="background:#e74c3c" onclick="deletePlan()">‚ùå Plan l√∂schen</button>

<input type="text" id="exerciseName" placeholder="√úbung">
<input type="number" id="sets" placeholder="S√§tze">
<label><input type="checkbox" id="bodyweight"> K√∂rpergewicht</label>
<textarea id="notes" placeholder="Notizen zur √úbung"></textarea>
<button onclick="addExercise()">√úbung hinzuf√ºgen</button>

<div id="exercises"></div>
</div>

<!-- TRAINING -->
<div id="training" class="tab">
<h2>Training starten</h2>
<select id="selectTrainingPlan" onchange="loadTrainingPlan()">
<option value="">-- Plan w√§hlen --</option>
</select>
<label>üìÖ Trainingsdatum:</label>
<input type="date" id="trainingDate" value="">
<div id="trainingExercises"></div>
<button onclick="saveTraining()">Training speichern</button>
</div>

<!-- FORTSCHRITT -->
<div id="progress" class="tab">
<h2>Fortschritt (plan√ºbergreifend)</h2>
<select id="exerciseSelectProgress" onchange="showProgressCrossPlans()">
<option value="">-- √úbung w√§hlen --</option>
</select>
<canvas id="chart" width="400" height="200"></canvas>
</div>

<!-- HISTORIE -->
<div id="history" class="tab">
<h2>Trainingshistorie</h2>
<div id="historyList"></div>
</div>

<!-- √úBERSICHT -->
<div id="overview" class="tab">
<h2>Alle Trainingspl√§ne</h2>
<div id="allPlans"></div>
</div>
</div>

<!-- Modal -->
<div id="editModal">
  <div class="modal-content">
    <h3>√úbung bearbeiten</h3>
    <label>Name</label><input type="text" id="editName">
    <label>S√§tze</label><input type="number" id="editSets">
    <label><input type="checkbox" id="editBodyweight"> K√∂rpergewicht</label>
    <label>Notizen</label><textarea id="editNotes"></textarea>
    <div class="modal-buttons">
      <button onclick="saveExerciseEdit()">Speichern</button>
      <button onclick="closeEditModal()">Abbrechen</button>
    </div>
  </div>
</div>

<script>
let plans = JSON.parse(localStorage.getItem('plans') || '{}');
let chart;
let editPlanName=null, editIndex=null;

function showTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
  document.getElementById('tabBtn'+id.charAt(0).toUpperCase()+id.slice(1)).classList.add('active');
  if(id==='plans') renderPlans();
  if(id==='progress') updateExerciseSelectProgress();
  if(id==='history') renderHistory();
}

function saveData(){ localStorage.setItem('plans', JSON.stringify(plans)); }
function renderPlans(){
  const sel=document.getElementById('selectPlan');
  const selTrain=document.getElementById('selectTrainingPlan');
  sel.innerHTML='<option value="">-- Plan w√§hlen --</option>';
  selTrain.innerHTML='<option value="">-- Plan w√§hlen --</option>';
  for(let p in plans){ sel.innerHTML+=`<option>${p}</option>`; selTrain.innerHTML+=`<option>${p}</option>`; }
  renderOverview();
}

/* --- PLAN FUNKTIONEN --- */
function addPlan(){
  const name=document.getElementById('planName').value.trim();
  if(!name) return alert('Planname fehlt');
  if(plans[name]) return alert('Plan existiert schon');
  plans[name]={exercises:[],history:[]};
  saveData(); renderPlans(); document.getElementById('planName').value='';
}
function deletePlan(){
  const plan=document.getElementById('selectPlan').value;
  if(!plan) return alert('Kein Plan gew√§hlt');
  if(confirm(`Plan "${plan}" wirklich l√∂schen?`)){
    delete plans[plan];
    saveData(); renderPlans();
    document.getElementById('exercises').innerHTML='';
  }
}
function loadPlan(){
  const plan=document.getElementById('selectPlan').value;
  const div=document.getElementById('exercises');
  div.innerHTML='';
  if(!plan) return;
  plans[plan].exercises.forEach((ex,i)=>{
    div.innerHTML+=`
      <div class="exercise-item">
        <b>${ex.name}</b> - ${ex.sets} S√§tze${ex.bodyweight?' (K√∂rpergewicht)':''}<br>
        Notizen: ${ex.notes||''}<br>
        <button onclick="openEditModal('${plan}',${i})">Bearbeiten</button>
        <button onclick="deleteExercise('${plan}',${i})">L√∂schen</button>
      </div>`;
  });
}
function addExercise(){
  const p=document.getElementById('selectPlan').value;
  if(!p) return alert('Plan w√§hlen');
  const n=document.getElementById('exerciseName').value.trim();
  const s=parseInt(document.getElementById('sets').value);
  const bw=document.getElementById('bodyweight').checked;
  const notes=document.getElementById('notes').value.trim();
  if(!n||!s) return alert('√úbung und S√§tze n√∂tig');
  plans[p].exercises.push({name:n,sets:s,bodyweight:bw,notes});
  saveData(); loadPlan();
  document.getElementById('exerciseName').value=''; document.getElementById('sets').value=''; document.getElementById('bodyweight').checked=false; document.getElementById('notes').value='';
}
function deleteExercise(p,i){ if(confirm('√úbung l√∂schen?')){ plans[p].exercises.splice(i,1); saveData(); loadPlan(); }}

/* Modal */
function openEditModal(p,i){ editPlanName=p; editIndex=i; const ex=plans[p].exercises[i];
  document.getElementById('editName').value=ex.name; document.getElementById('editSets').value=ex.sets;
  document.getElementById('editBodyweight').checked=ex.bodyweight; document.getElementById('editNotes').value=ex.notes||'';
  document.getElementById('editModal').style.display='flex';
}
function closeEditModal(){ document.getElementById('editModal').style.display='none'; }
function saveExerciseEdit(){
  const ex=plans[editPlanName].exercises[editIndex];
  ex.name=document.getElementById('editName').value.trim();
  ex.sets=parseInt(document.getElementById('editSets').value);
  ex.bodyweight=document.getElementById('editBodyweight').checked;
  ex.notes=document.getElementById('editNotes').value.trim();
  saveData(); closeEditModal(); loadPlan();
}

/* TRAINING */
function loadTrainingPlan(){
  const p=document.getElementById('selectTrainingPlan').value;
  const div=document.getElementById('trainingExercises'); div.innerHTML='';
  if(!p) return;
  document.getElementById('trainingDate').value=new Date().toISOString().split('T')[0];
  plans[p].exercises.forEach(ex=>{
    let html=`<div class='exercise-item'><b>${ex.name}</b><br>`;
    for(let i=1;i<=ex.sets;i++){
      html+=`Satz ${i}: `;
      if(!ex.bodyweight) html+=`<input type='number' placeholder='Gewicht' id='${ex.name}_w${i}' style='width:45%'> `;
      html+=`<input type='number' placeholder='Wdh' id='${ex.name}_r${i}' style='width:45%'><br>`;
    }
    html+=`<textarea id='${ex.name}_note' placeholder='Notiz'></textarea></div>`;
    div.innerHTML+=html;
  });
}
function saveTraining(){
  const p=document.getElementById('selectTrainingPlan').value;
  if(!p) return alert('Plan w√§hlen');
  const date=document.getElementById('trainingDate').value;
  const exercises=[];
  plans[p].exercises.forEach(ex=>{
    const setsData=[];
    for(let i=1;i<=ex.sets;i++){
      const w=!ex.bodyweight?parseFloat(document.getElementById(`${ex.name}_w${i}`).value)||0:0;
      const r=parseInt(document.getElementById(`${ex.name}_r${i}`).value)||0;
      setsData.push({weight:w,reps:r});
    }
    const note=document.getElementById(`${ex.name}_note`).value;
    exercises.push({name:ex.name,setsData,note});
  });
  plans[p].history.push({date,exercises});
  saveData();
  alert('Training gespeichert!');
}

/* FORTSCHRITT */
function updateExerciseSelectProgress(){
  const sel=document.getElementById('exerciseSelectProgress');
  sel.innerHTML='<option value="">-- √úbung w√§hlen --</option>';
  const names=new Set();
  for(let p in plans){ plans[p].exercises.forEach(ex=>names.add(ex.name)); }
  names.forEach(n=>sel.innerHTML+=`<option>${n}</option>`);
}
function showProgressCrossPlans(){
  const name=document.getElementById('exerciseSelectProgress').value;
  if(!name) return;
  const data=[];
  for(let p in plans){
    plans[p].history.forEach(h=>{
      h.exercises.forEach(ex=>{
        if(ex.name===name){
          const total=ex.setsData.reduce((a,s)=>a+(s.weight*s.reps),0);
          data.push({date:h.date,total});
        }
      });
    });
  }
  data.sort((a,b)=>new Date(a.date)-new Date(b.date));
  if(chart) chart.destroy();
  chart=new Chart(document.getElementById('chart'),{
    type:'line',
    data:{labels:data.map(d=>d.date),datasets:[{label:name,data:data.map(d=>d.total),fill:false,borderWidth:2}]},
    options:{responsive:true,scales:{y:{beginAtZero:true,title:{display:true,text:'Wdh √ó Gewicht'}}}}
  });
}

/* HISTORIE */
function renderHistory(){
  const div=document.getElementById('historyList'); div.innerHTML='';
  for(let p in plans){
    plans[p].history.forEach((h,idx)=>{
      div.innerHTML+=`<div class='history-item'>
        <b>${p}</b> - ${h.date}<br>
        ${h.exercises.map(e=>`${e.name}: ${e.setsData.map(s=>`${s.weight}kg√ó${s.reps}`).join(', ')}`).join('<br>')}
        <br><button style='background:#e74c3c' onclick="deleteHistory('${p}',${idx})">L√∂schen</button>
      </div>`;
    });
  }
}
function deleteHistory(plan,index){
  if(confirm('Eintrag l√∂schen?')){
    plans[plan].history.splice(index,1);
    saveData(); renderHistory();
  }
}

/* √úBERSICHT */
function renderOverview(){
  const o=document.getElementById('allPlans');
  o.innerHTML='';
  for(let p in plans){
    o.innerHTML+=`<h3>${p}</h3><ul>`+
      plans[p].exercises.map(ex=>`<li>${ex.name} (${ex.sets} S√§tze) ${ex.bodyweight?'(K√∂rpergewicht)':''}<br>Notizen: ${ex.notes||''}</li>`).join('')+
      '</ul>';
  }
}

renderPlans();
</script>
</body>
</html>
