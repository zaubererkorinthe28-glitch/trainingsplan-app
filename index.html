<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Trainings-App</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { margin:0; font-family:-apple-system,Arial,Helvetica,sans-serif; background:#f0f2f5; color:#222; }
.container { max-width:720px; margin:18px auto; padding:16px; }
header { background:#4caf50; color:#fff; border-radius:10px; padding:12px; text-align:center; box-shadow:0 2px 6px rgba(0,0,0,0.12); }
h1 { margin:0; font-size:20px; }
.nav { display:flex; gap:6px; margin:12px 0; flex-wrap:wrap; }
.nav button { flex:1; padding:8px; border-radius:8px; border:0; background:#eee; cursor:pointer; }
.nav button.active { background:#4caf50; color:#fff; }
.tab { display:none; }
.tab.active { display:block; }
input,select,textarea,button { width:100%; padding:8px; margin:6px 0; border-radius:8px; border:1px solid #ccc; box-sizing:border-box; }
button.primary { background:#4caf50; color:#fff; border:0; cursor:pointer; }
.exercise-item { background:#fff; border:1px solid #ddd; padding:8px; border-radius:8px; margin:6px 0; }
.flex-row { display:flex; gap:8px; align-items:center; }
.flex-row input { flex:1; }
.modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); justify-content:center; align-items:center; z-index:9999; }
.modal .card { background:#fff; padding:16px; border-radius:10px; width:92%; max-width:720px; }
.modal .row { margin-bottom:8px; }
.history-item { background:#fff; border:1px solid #ddd; border-radius:8px; padding:8px; margin:8px 0; }
.danger { background:#e74c3c; color:#fff; border:0; cursor:pointer; }
label.small { font-size:13px; color:#555; display:block; margin:6px 0; }
canvas { background:#fff; border-radius:8px; padding:8px; display:block; width:100% !important; height:320px !important; }
.small-btn { padding:6px 8px; font-size:14px; border-radius:6px; }
.row-flex { display:flex; gap:8px; }
.col { flex:1; }
.note { font-size:13px; color:#555; margin-top:6px; }
</style>
</head>
<body>
<div class="container">
<header><h1>üèãÔ∏è Trainings-App</h1></header>
<div class="nav">
<button id="btnPlans" class="active" onclick="showTab('plans')">Pl√§ne</button>
<button id="btnTraining" onclick="showTab('training')">Training</button>
<button id="btnProgress" onclick="showTab('progress')">Fortschritt</button>
<button id="btnHistory" onclick="showTab('history')">Historie</button>
<button id="btnOverview" onclick="showTab('overview')">√úbersicht</button>
</div>

<!-- PL√ÑNE -->
<div id="plans" class="tab active">
<h2>Neuen Plan erstellen</h2>
<input id="planName" placeholder="Planname">
<button class="primary" onclick="addPlan()">Plan hinzuf√ºgen</button>

<h3>Plan bearbeiten</h3>
<select id="selectPlan" onchange="loadPlan()"><option value="">-- Plan w√§hlen --</option></select>
<div style="display:flex; gap:6px;">
<button onclick="openRenameModal()" style="flex:1;">Plan umbenennen</button>
<button class="danger" onclick="openDeleteModal()" style="flex:1;">Plan l√∂schen</button>
</div>

<input id="exerciseName" placeholder="√úbung">
<input id="sets" type="number" placeholder="S√§tze">
<label class="small"><input id="bodyweight" type="checkbox"> K√∂rpergewicht</label>
<textarea id="notes" placeholder="Notizen zur √úbung"></textarea>
<button onclick="addExercise()">√úbung hinzuf√ºgen</button>

<div id="exercises"></div>
</div>

<!-- TRAINING -->
<div id="training" class="tab">
<h2>Training starten</h2>
<select id="selectTrainingPlan" onchange="loadTrainingPlan()"><option value="">-- Plan w√§hlen --</option></select>
<label class="small">üìÖ Trainingsdatum</label>
<input id="trainingDate" type="date">
<div id="trainingExercises"></div>
<button class="primary" onclick="saveTraining()">Training speichern</button>
</div>

<!-- FORTSCHRITT -->
<div id="progress" class="tab">
<h2>Fortschritt (plan√ºbergreifend)</h2>
<div class="row-flex">
<div class="col">
<select id="exerciseSelectProgress" onchange="renderProgressChart()"><option value="">-- √úbung w√§hlen --</option></select>
</div>
<div style="width:220px">
<select id="displayMode" onchange="renderProgressChart()">
<option value="sum">Summe (Wdh√óGewicht / Wdh)</option>
<option value="max">Max (Gewicht / Wdh)</option>
</select>
</div>
</div>
<canvas id="chart"></canvas>
</div>

<!-- HISTORIE -->
<div id="history" class="tab">
<h2>Trainingshistorie</h2>
<div id="historyList"></div>
</div>

<!-- √úBERSICHT -->
<div id="overview" class="tab">
<h2>Alle Trainingspl√§ne</h2>
<div id="allPlans"></div>
<br>
<h3>Backup</h3>
<button onclick="exportData()" class="primary">Exportieren (JSON)</button>
<input type="file" id="importFile" style="margin-top:6px" onchange="importData(this)">
</div>

</div>

<!-- Modal: √úbung bearbeiten -->
<div id="editModal" class="modal">
<div class="card">
<h3>√úbung bearbeiten</h3>
<div class="row"><label class="small">Name</label><input id="editName"></div>
<div class="row"><label class="small">S√§tze</label><input id="editSets" type="number"></div>
<div class="row"><label class="small"><input id="editBodyweight" type="checkbox"> K√∂rpergewicht</label></div>
<div class="row"><label class="small">Notizen</label><textarea id="editNotes"></textarea></div>
<div style="display:flex;gap:8px;justify-content:space-between">
<button class="primary" onclick="saveExerciseEdit()">Speichern</button>
<button onclick="closeEditModal()">Abbrechen</button>
</div>
</div>
</div>

<!-- Modal: Plan umbenennen -->
<div id="renameModal" class="modal">
<div class="card">
<h3>Plan umbenennen</h3>
<div class="row"><label class="small">Neuer Name</label><input id="renamePlanInput" placeholder="Neuer Planname"></div>
<div style="display:flex;gap:8px;justify-content:space-between">
<button class="primary" onclick="renamePlan()">Speichern</button>
<button onclick="closeRenameModal()">Abbrechen</button>
</div>
</div>
</div>

<!-- Modal: Plan l√∂schen -->
<div id="deleteModal" class="modal">
<div class="card">
<h3>Plan l√∂schen</h3>
<p id="deletePlanText"></p>
<div style="display:flex;gap:8px;justify-content:space-between">
<button class="danger" onclick="deletePlanConfirmed()">Ja, l√∂schen</button>
<button onclick="closeDeleteModal()">Abbrechen</button>
</div>
</div>
</div>

<!-- Modal: Historien-Eintrag bearbeiten -->
<div id="editHistoryModal" class="modal">
<div class="card">
<h3>Historien-Eintrag bearbeiten</h3>
<div id="historyEditContent"></div>
<div style="display:flex;gap:8px;justify-content:space-between;margin-top:10px;">
<button class="primary" onclick="saveHistoryEdit()">Speichern</button>
<button onclick="closeEditHistoryModal()">Abbrechen</button>
</div>
</div>
</div>

<!-- Debug -->
<div style="max-width:720px;margin:12px auto; padding:10px; background:#fff; border:1px solid #ccc; border-radius:6px;">
<h4>Debug Daten</h4>
<div style="display:flex;gap:8px;">
<button onclick="showDebugData()" class="small-btn">Daten anzeigen</button>
<button onclick="clearDebug()" class="small-btn">localStorage leeren</button>
</div>
<pre id="debugOutput" style="white-space:pre-wrap; max-height:240px; overflow:auto; margin-top:8px;"></pre>
</div>

<script>
// --- Daten & Hilfsvariablen ---
let plans = JSON.parse(localStorage.getItem('plans')||'{}');
let chart = null;
let editing = {plan:null,index:null};
let historyEditing = {plan:null,index:null};
let planToDelete = null;

// --- Storage ---
function saveData(){ localStorage.setItem('plans',JSON.stringify(plans)); }

// --- Tabs ---
function showTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
  document.getElementById('btn'+id.charAt(0).toUpperCase()+id.slice(1)).classList.add('active');
  if(id==='plans') renderPlanSelectors();
  if(id==='progress') updateExerciseSelectProgress();
  if(id==='history') renderHistory();
  if(id==='overview') renderOverview();
}

// --- Planverwaltung ---
function renderPlanSelectors(){
  const sel=document.getElementById('selectPlan');
  const selTrain=document.getElementById('selectTrainingPlan');
  sel.innerHTML='<option value="">-- Plan w√§hlen --</option>';
  selTrain.innerHTML='<option value="">-- Plan w√§hlen --</option>';
  for(let p in plans){
    sel.innerHTML+=`<option value="${p}">${p}</option>`;
    selTrain.innerHTML+=`<option value="${p}">${p}</option>`;
  }
  loadPlan();
}

function addPlan(){
  const name=document.getElementById('planName').value.trim();
  if(!name) return alert('Planname fehlt');
  if(plans[name]) return alert('Plan existiert bereits');
  plans[name]={exercises:[],history:[]};
  saveData();
  document.getElementById('planName').value='';
  renderPlanSelectors();
  renderOverview();
}

function openDeleteModal(){
  const sel=document.getElementById('selectPlan').value;
  if(!sel) return alert('Bitte zuerst einen Plan ausw√§hlen.');
  planToDelete = sel;
  document.getElementById('deletePlanText').innerHTML = `M√∂chtest du den Plan <strong>"${sel}"</strong> wirklich l√∂schen?`;
  document.getElementById('deleteModal').style.display='flex';
}

function closeDeleteModal(){ document.getElementById('deleteModal').style.display='none'; planToDelete=null; }

function deletePlanConfirmed(){
  if(!planToDelete) return;
  delete plans[planToDelete];
  saveData();
  renderPlanSelectors();
  document.getElementById('exercises').innerHTML='';
  closeDeleteModal();
  renderOverview();
  alert(`Plan "${planToDelete}" gel√∂scht.`);
}

// --- Rename Plan Modal ---
function openRenameModal(){
  const sel=document.getElementById('selectPlan').value;
  if(!sel) return alert('Bitte zuerst einen Plan ausw√§hlen.');
  document.getElementById('renamePlanInput').value = sel;
  document.getElementById('renameModal').style.display='flex';
  editing.plan = sel;
}
function closeRenameModal(){ document.getElementById('renameModal').style.display='none'; editing.plan=null; }
function renamePlan(){
  const newName = document.getElementById('renamePlanInput').value.trim();
  if(!editing.plan) return alert('Kein Plan ausgew√§hlt.');
  if(!newName) return alert('Name darf nicht leer sein');
  if(plans[newName] && newName !== editing.plan) return alert('Ein Plan mit diesem Namen existiert bereits.');
  plans[newName] = plans[editing.plan];
  if(newName !== editing.plan) delete plans[editing.plan];
  saveData();
  renderPlanSelectors();
  closeRenameModal();
  renderOverview();
  alert(`Plan "${editing.plan}" wurde in "${newName}" umbenannt.`);
}

// --- √úbungen verwalten ---
function loadPlan(){
  const plan=document.getElementById('selectPlan').value;
  const container=document.getElementById('exercises'); container.innerHTML='';
  if(!plan||!plans[plan]) return;
  plans[plan].exercises.forEach((ex,i)=>{
    const el=document.createElement('div'); el.className='exercise-item';
    el.innerHTML=`<strong>${ex.name}</strong> ‚Äî ${ex.sets} S√§tze ${ex.bodyweight? '(K√∂rpergewicht)':''}
    <div style="margin-top:6px"><small>${ex.notes||''}</small></div>
    <div style="margin-top:8px;display:flex;gap:8px">
      <button onclick="openEditModal('${plan}',${i})">Bearbeiten</button>
      <button onclick="deleteExercise('${plan}',${i})" class="danger">L√∂schen</button>
    </div>`;
    container.appendChild(el);
  });
}

function addExercise(){
  const plan=document.getElementById('selectPlan').value;
  if(!plan) return alert('Bitte Plan w√§hlen');
  const name=document.getElementById('exerciseName').value.trim();
  const sets=parseInt(document.getElementById('sets').value);
  const bodyweight=document.getElementById('bodyweight').checked;
  const notes=document.getElementById('notes').value.trim();
  if(!name||!sets) return alert('√úbung & S√§tze erforderlich');
  plans[plan].exercises.push({name,sets,bodyweight,notes});
  saveData();
  document.getElementById('exerciseName').value=''; document.getElementById('sets').value=''; document.getElementById('bodyweight').checked=false; document.getElementById('notes').value='';
  loadPlan();
  updateExerciseSelectProgress();
  renderOverview();
}

// --- Edit Modal f√ºr √úbungen ---
function openEditModal(plan,i){
  editing={plan,index:i};
  const ex=plans[plan].exercises[i];
  document.getElementById('editName').value=ex.name;
  document.getElementById('editSets').value=ex.sets;
  document.getElementById('editBodyweight').checked=ex.bodyweight;
  document.getElementById('editNotes').value=ex.notes||'';
  document.getElementById('editModal').style.display='flex';
}
function closeEditModal(){ document.getElementById('editModal').style.display='none'; editing={plan:null,index:null}; }
function saveExerciseEdit(){
  const ex=plans[editing.plan].exercises[editing.index];
  ex.name=document.getElementById('editName').value.trim();
  ex.sets=parseInt(document.getElementById('editSets').value)||ex.sets;
  ex.bodyweight=document.getElementById('editBodyweight').checked;
  ex.notes=document.getElementById('editNotes').value.trim();
  saveData();
  closeEditModal();
  loadPlan();
  updateExerciseSelectProgress();
  renderOverview();
}

function deleteExercise(plan,i){
  if(!confirm('√úbung l√∂schen?')) return;
  plans[plan].exercises.splice(i,1);
  saveData();
  loadPlan();
  updateExerciseSelectProgress();
  renderOverview();
}

// --- Training ---
function loadTrainingPlan(){
  const plan=document.getElementById('selectTrainingPlan').value;
  const cont=document.getElementById('trainingExercises'); cont.innerHTML='';
  if(!plan||!plans[plan]) return;
  const today=new Date().toISOString().split('T')[0];
  if(!document.getElementById('trainingDate').value) document.getElementById('trainingDate').value=today;
  plans[plan].exercises.forEach((ex,exIdx)=>{
    const wrapper=document.createElement('div'); wrapper.className='exercise-item';
    let inner=`<strong>${ex.name}</strong> ${ex.bodyweight? '(K√∂rpergewicht)':''}<div style="margin-top:6px">`;
    for(let s=1;s<=ex.sets;s++){
      if(!ex.bodyweight){
        inner+=`<div class="flex-row"><div style="width:110px">Satz ${s}:</div><input type="number" id="w_${exIdx}_${s}" placeholder="Gewicht (kg)"><input type="number" id="r_${exIdx}_${s}" placeholder="Wdh"></div>`;
      } else {
        inner+=`<div class="flex-row"><div style="width:110px">Satz ${s}:</div><input type="number" id="r_${exIdx}_${s}" placeholder="Wdh"></div>`;
      }
    }
    inner+=`<textarea id="note_${exIdx}" placeholder="Notizen (optional)">${ex.notes||''}</textarea></div>`;
    wrapper.innerHTML=inner; cont.appendChild(wrapper);
  });
}

function saveTraining(){
  const plan=document.getElementById('selectTrainingPlan').value;
  if(!plan) return alert('Bitte Plan w√§hlen');
  const date=document.getElementById('trainingDate').value||new Date().toISOString().split('T')[0];
  const exercisesSaved=[];
  plans[plan].exercises.forEach((ex,exIdx)=>{
    const setsData=[];
    for(let s=1;s<=ex.sets;s++){
      const reps=parseInt(document.getElementById(`r_${exIdx}_${s}`)?.value) || 0;
      const weight=ex.bodyweight?0:(parseFloat(document.getElementById(`w_${exIdx}_${s}`)?.value)||0);
      if(reps>0 || weight>0){
        setsData.push({weight,reps});
      }
    }
    const note=document.getElementById(`note_${exIdx}`)?.value||'';
    exercisesSaved.push({name:ex.name,setsData,note,bodyweight:ex.bodyweight});
  });
  if(!plans[plan].history) plans[plan].history=[];
  plans[plan].history.push({date,exercises:exercisesSaved});
  saveData();
  alert('Training gespeichert!');
  renderHistory();
  updateExerciseSelectProgress();
  renderOverview();
}

// --- Historie ---
function renderHistory(){
  const div=document.getElementById('historyList'); div.innerHTML='';
  let anyEntry=false;
  for(let p in plans){
    const hist=plans[p].history||[];
    if(hist.length===0) continue;
    anyEntry=true;
    const header=document.createElement('h3'); header.textContent=`üìò ${p}`; div.appendChild(header);
    hist.slice().reverse().forEach((h,idx)=>{
      const realIdx = hist.length -1 - idx;
      const card=document.createElement('div'); card.className='history-item';
      let inner=`<div style="display:flex;justify-content:space-between;align-items:center"><strong>${h.date}</strong>
      <div><button onclick="openEditHistoryModal('${p}',${realIdx})" class="small-btn">Bearbeiten</button>
      <button onclick="deleteHistory('${p}',${realIdx})" class="danger small-btn">L√∂schen</button></div></div><div style="margin-top:6px">`;
      if(!h.exercises || h.exercises.length===0){
        inner+=`<div>Keine √úbungen</div>`;
      } else {
        h.exercises.forEach(ex=>{
          const setsText = (ex.setsData && ex.setsData.length) ? ex.setsData.map(s=> (ex.bodyweight ? `${s.reps}w` : `${s.weight}kg√ó${s.reps}`)).join(', ') : '‚Äì';
          inner+=`<div style="margin-top:6px"><strong>${ex.name}</strong>: ${setsText}${ex.note?`<div class="note">${ex.note}</div>`:''}</div>`;
        });
      }
      inner+='</div>';
      card.innerHTML=inner;
      div.appendChild(card);
    });
  }
  if(!anyEntry) div.innerHTML='<i>Keine Trainingshistorie vorhanden</i>';
}

function deleteHistory(plan,index){
  if(!confirm('Eintrag l√∂schen?')) return;
  plans[plan].history.splice(index,1);
  saveData();
  renderHistory();
  updateExerciseSelectProgress();
  renderOverview();
}

// --- Edit History Modal (voll editierbar) ---
function openEditHistoryModal(plan,index){
  historyEditing={plan,index};
  const entry = plans[plan].history[index];
  const container=document.getElementById('historyEditContent'); container.innerHTML='';
  container.innerHTML += `<div class="row"><label class="small">Datum</label><input id="hist_date" type="date" value="${entry.date}"></div>`;
  entry.exercises.forEach((ex,exIdx)=>{
    const exDiv=document.createElement('div'); exDiv.className='exercise-item';
    let inner=`<strong>${ex.name}</strong> ${ex.bodyweight? '(K√∂rpergewicht)':''}<div style="margin-top:6px">`;
    const planDef = (plans[plan].exercises.find(e=>e.name===ex.name) || {});
    const maxSets = Math.max(planDef.sets || 0, ex.setsData.length || 0, 1);
    for(let s=0;s<maxSets;s++){
      const w = ex.setsData[s] ? ex.setsData[s].weight : '';
      const r = ex.setsData[s] ? ex.setsData[s].reps : '';
      if(!ex.bodyweight){
        inner+=`<div class="flex-row"><div style="width:110px">Satz ${s+1}:</div><input type="number" class="hist_w" data-ex="${exIdx}" data-set="${s}" value="${w}" placeholder="Gewicht (kg)"><input type="number" class="hist_r" data-ex="${exIdx}" data-set="${s}" value="${r}" placeholder="Wdh"></div>`;
      } else {
        inner+=`<div class="flex-row"><div style="width:110px">Satz ${s+1}:</div><input type="number" class="hist_r" data-ex="${exIdx}" data-set="${s}" value="${r}" placeholder="Wdh"></div>`;
      }
    }
    inner+=`<div style="margin-top:6px"><label class="small">Notiz</label><textarea id="hist_note_${exIdx}">${ex.note||''}</textarea></div>`;
    inner+=`</div>`;
    exDiv.innerHTML=inner;
    container.appendChild(exDiv);
  });
  document.getElementById('editHistoryModal').style.display='flex';
}

function closeEditHistoryModal(){ document.getElementById('editHistoryModal').style.display='none'; historyEditing={plan:null,index:null}; }

function saveHistoryEdit(){
  const {plan,index} = historyEditing;
  if(!plan) return;
  const entry = plans[plan].history[index];
  entry.date = document.getElementById('hist_date').value || entry.date;
  entry.exercises.forEach((ex,exIdx)=>{
    const inputsW = Array.from(document.querySelectorAll(`.hist_w[data-ex="${exIdx}"]`));
    const inputsR = Array.from(document.querySelectorAll(`.hist_r[data-ex="${exIdx}"]`));
    const sets=[];
    const count = Math.max(inputsR.length, inputsW.length);
    for(let s=0;s<count;s++){
      const wIn = inputsW.find(i=>parseInt(i.dataset.set)===s);
      const rIn = inputsR.find(i=>parseInt(i.dataset.set)===s);
      const weight = wIn ? parseFloat(wIn.value)||0 : 0;
      const reps = rIn ? parseInt(rIn.value)||0 : 0;
      if(weight>0 || reps>0) sets.push({weight,reps});
    }
    ex.setsData = sets;
    ex.note = document.getElementById(`hist_note_${exIdx}`)?.value || '';
  });
  saveData();
  closeEditHistoryModal();
  renderHistory();
  updateExerciseSelectProgress();
  renderOverview();
  alert('Historien-Eintrag gespeichert.');
}

// --- Fortschritt / Chart ---
function updateExerciseSelectProgress(){
  const sel=document.getElementById('exerciseSelectProgress');
  sel.innerHTML='<option value="">-- √úbung w√§hlen --</option>';
  const names=new Set();
  for(let p in plans){
    (plans[p].exercises || []).forEach(e=>names.add(e.name));
  }
  Array.from(names).forEach(n=>{ sel.innerHTML+=`<option value="${n}">${n}</option>`; });
  renderProgressChart();
}


function renderProgressChart() {
  const name = document.getElementById('exerciseSelectProgress').value;
  if (!name) return;

  const mode = document.getElementById('displayMode').value;
  let data = [];
  let labels = [];

  // Alle Trainingsdaten durchsuchen
  for (let p in plans) {
    plans[p].history.forEach(h => {
      const ex = h.exercises.find(e => e.name === name);
      if (ex) {
        let y = 0;

        // K√∂rpergewichts√ºbung ‚Üí Wiederholungen z√§hlen
        if (ex.bodyweight) {
          if (mode === 'sum') {
            // Gesamtwiederholungen des Tages
            y = ex.setsData.reduce((a, s) => a + s.reps, 0);
          } else {
            // Maximale Wiederholungen eines Satzes
            y = Math.max(...ex.setsData.map(s => s.reps));
          }
        } else {
          // Gewichtete √úbung ‚Üí Gewicht √ó Wiederholungen oder Max Gewicht
          if (mode === 'sum') {
            y = ex.setsData.reduce((a, s) => a + s.weight * s.reps, 0);
          } else {
            y = Math.max(...ex.setsData.map(s => s.weight));
          }
        }

        data.push(y);
        labels.push(h.date);
      }
    });
  }

  // üîΩ Daten chronologisch sortieren (√§ltestes links, neuestes rechts)
  const combined = labels.map((date, i) => ({ date, value: data[i] }))
    .sort((a, b) => new Date(a.date) - new Date(b.date));
  labels = combined.map(c => c.date);
  data = combined.map(c => c.value);

  // Vorherigen Chart l√∂schen, wenn vorhanden
  if (chart) chart.destroy();

  if (data.length === 0) {
    const ctx = document.getElementById('chart').getContext('2d');
    ctx.clearRect(0, 0, 500, 300);
    return;
  }

  // Neues Diagramm erstellen
  const ctx = document.getElementById('chart').getContext('2d');
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: name,
        data,
        fill: false,
        borderColor: '#4caf50',
        tension: 0.25
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
}




// --- Import / Export ---
function exportData(){
  const dataStr=JSON.stringify(plans,null,2);
  const blob=new Blob([dataStr],{type:"application/json"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='trainings_backup.json';
  document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
}
function importData(input){
  const file=input.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=function(e){
    try{
      const imported=JSON.parse(e.target.result);
      if(!confirm('Importiert werden alle Pl√§ne. Alte Daten gehen verloren. Fortfahren?')) return;
      plans=imported;
      saveData(); renderPlanSelectors(); renderHistory(); updateExerciseSelectProgress(); renderOverview();
      alert('Import erfolgreich!');
    }catch(err){ alert('Fehler beim Import: '+err.message); }
  };
  reader.readAsText(file);
}

// --- Debug ---
function showDebugData(){ document.getElementById('debugOutput').textContent = JSON.stringify(plans,null,2); }
function clearDebug(){ if(confirm('localStorage wirklich leeren?')){ localStorage.removeItem('plans'); plans={}; saveData(); renderPlanSelectors(); renderHistory(); updateExerciseSelectProgress(); renderOverview(); document.getElementById('debugOutput').textContent=''; alert('Gel√∂scht.'); } }

// --- Initialisierung ---
renderPlanSelectors();
updateExerciseSelectProgress();
renderHistory();
renderOverview();

// --- Utility: close modals when clicking outside ---
window.addEventListener('click', function(e){
  if(e.target && e.target.classList && e.target.classList.contains('modal')){
    e.target.style.display='none';
    editing={plan:null,index:null};
    historyEditing={plan:null,index:null};
    planToDelete=null;
  }
});
</script>
</body>
</html>
